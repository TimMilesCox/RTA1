MASMX 7r3A Build 12
3/loader.msm
*EOF*
  :                            12 	$list
  :                            13 
  :                            14 $(1:01000/$1)
  :                            15 $(3:03000/$3)
  :                            16 
  :                            17 	$lit	4
  :                            18 
  :                            19 $(4:*1/$4)
  :                            20 $(0:*1/$0)
  :                            21 
  :                            22 loader*
  :                            23 	$list	2
  :                            24: 	$include	../source.app/loader
  :                            1: 	$include	../source.app/loader.def
  :                            2: 	$include	../table/lookup.def
  :                            3: 	$include	../lib/ascii.def
  :                            4 
  :                            5 	$set_option	"z"
  :                            6 
  :                            7 $(3)
  :                            8 command1	$res	180/3	. application name like argv[0]
  :                            9 				. only read once ahead of commands
  :                            10 request1	$res	180/3	. entire fgets line
  :                            11 request         $res	180/3	. 1st term on input line
  :                            12 request2	$res	180/3
  :                            13 request3	$res	180/3
  :                            14 request4	$res	180/3	. potential last term last in
  :                            15 suffix		$res	180/3	. to extract *suffix
  :                            16 				. without overwriting request[2 3 4]
03:0031A4  000000              +17 arguments	0
  :                            18 new_process	$res	1
03:0031A6  000000 000000 000000 000000 000000
                              +19 loadname	0p		. 4 + trailing zero word
  :                            20 				. in case load file name is 12+ symbols
  :                            21 
  :                            22 APPS_MAXIMUM	$equ	48
03:0031AB  000000              +23 app_of_reference 0
03:0031AC  0031AE              +24 app_cache_free	+	app(1)
03:0031AD  000000              +25 apps_loaded	0
  :                            26 
03:0031AE  0031C2              +27 ?	$do	APPS_MAXIMUM,app(?)	file_image	app(?+1)
03:0031AF  000000              +27 
03:0031B0  000000 000000        +27 
03:0031B2  000000 000000        +27 
03:0031B4  000000              +27 
03:0031B5  000000              +27 
03:0031B6  000000 000000 000000 000000
                              +27 
03:0031BA  000000 000000 000000 000000
                              +27 
03:0031BE  000000 000000 000000 000000
                              +27 
03:0031C2  0031D6              +27 
03:0031C3  000000              +27 
03:0031C4  000000 000000        +27 
03:0031C6  000000 000000        +27 
03:0031C8  000000              +27 
03:0031C9  000000              +27 
03:0031CA  000000 000000 000000 000000
                              +27 
03:0031CE  000000 000000 000000 000000
                              +27 
03:0031D2  000000 000000 000000 000000
                              +27 
03:0031D6  0031EA              +27 
03:0031D7  000000              +27 
03:0031D8  000000 000000        +27 
03:0031DA  000000 000000        +27 
03:0031DC  000000              +27 
03:0031DD  000000              +27 
03:0031DE  000000 000000 000000 000000
                              +27 
03:0031E2  000000 000000 000000 000000
                              +27 
03:0031E6  000000 000000 000000 000000
                              +27 
03:0031EA  0031FE              +27 
03:0031EB  000000              +27 
03:0031EC  000000 000000        +27 
03:0031EE  000000 000000        +27 
03:0031F0  000000              +27 
03:0031F1  000000              +27 
03:0031F2  000000 000000 000000 000000
                              +27 
03:0031F6  000000 000000 000000 000000
                              +27 
03:0031FA  000000 000000 000000 000000
                              +27 
03:0031FE  003212              +27 
03:0031FF  000000              +27 
03:003200  000000 000000        +27 
03:003202  000000 000000        +27 
03:003204  000000              +27 
03:003205  000000              +27 
03:003206  000000 000000 000000 000000
                              +27 
03:00320A  000000 000000 000000 000000
                              +27 
03:00320E  000000 000000 000000 000000
                              +27 
03:003212  003226              +27 
03:003213  000000              +27 
03:003214  000000 000000        +27 
03:003216  000000 000000        +27 
03:003218  000000              +27 
03:003219  000000              +27 
03:00321A  000000 000000 000000 000000
                              +27 
03:00321E  000000 000000 000000 000000
                              +27 
03:003222  000000 000000 000000 000000
                              +27 
03:003226  00323A              +27 
03:003227  000000              +27 
03:003228  000000 000000        +27 
03:00322A  000000 000000        +27 
03:00322C  000000              +27 
03:00322D  000000              +27 
03:00322E  000000 000000 000000 000000
                              +27 
03:003232  000000 000000 000000 000000
                              +27 
03:003236  000000 000000 000000 000000
                              +27 
03:00323A  00324E              +27 
03:00323B  000000              +27 
03:00323C  000000 000000        +27 
03:00323E  000000 000000        +27 
03:003240  000000              +27 
03:003241  000000              +27 
03:003242  000000 000000 000000 000000
                              +27 
03:003246  000000 000000 000000 000000
                              +27 
03:00324A  000000 000000 000000 000000
                              +27 
03:00324E  003262              +27 
03:00324F  000000              +27 
03:003250  000000 000000        +27 
03:003252  000000 000000        +27 
03:003254  000000              +27 
03:003255  000000              +27 
03:003256  000000 000000 000000 000000
                              +27 
03:00325A  000000 000000 000000 000000
                              +27 
03:00325E  000000 000000 000000 000000
                              +27 
03:003262  003276              +27 
03:003263  000000              +27 
03:003264  000000 000000        +27 
03:003266  000000 000000        +27 
03:003268  000000              +27 
03:003269  000000              +27 
03:00326A  000000 000000 000000 000000
                              +27 
03:00326E  000000 000000 000000 000000
                              +27 
03:003272  000000 000000 000000 000000
                              +27 
03:003276  00328A              +27 
03:003277  000000              +27 
03:003278  000000 000000        +27 
03:00327A  000000 000000        +27 
03:00327C  000000              +27 
03:00327D  000000              +27 
03:00327E  000000 000000 000000 000000
                              +27 
03:003282  000000 000000 000000 000000
                              +27 
03:003286  000000 000000 000000 000000
                              +27 
03:00328A  00329E              +27 
03:00328B  000000              +27 
03:00328C  000000 000000        +27 
03:00328E  000000 000000        +27 
03:003290  000000              +27 
03:003291  000000              +27 
03:003292  000000 000000 000000 000000
                              +27 
03:003296  000000 000000 000000 000000
                              +27 
03:00329A  000000 000000 000000 000000
                              +27 
03:00329E  0032B2              +27 
03:00329F  000000              +27 
03:0032A0  000000 000000        +27 
03:0032A2  000000 000000        +27 
03:0032A4  000000              +27 
03:0032A5  000000              +27 
03:0032A6  000000 000000 000000 000000
                              +27 
03:0032AA  000000 000000 000000 000000
                              +27 
03:0032AE  000000 000000 000000 000000
                              +27 
03:0032B2  0032C6              +27 
03:0032B3  000000              +27 
03:0032B4  000000 000000        +27 
03:0032B6  000000 000000        +27 
03:0032B8  000000              +27 
03:0032B9  000000              +27 
03:0032BA  000000 000000 000000 000000
                              +27 
03:0032BE  000000 000000 000000 000000
                              +27 
03:0032C2  000000 000000 000000 000000
                              +27 
03:0032C6  0032DA              +27 
03:0032C7  000000              +27 
03:0032C8  000000 000000        +27 
03:0032CA  000000 000000        +27 
03:0032CC  000000              +27 
03:0032CD  000000              +27 
03:0032CE  000000 000000 000000 000000
                              +27 
03:0032D2  000000 000000 000000 000000
                              +27 
03:0032D6  000000 000000 000000 000000
                              +27 
03:0032DA  0032EE              +27 
03:0032DB  000000              +27 
03:0032DC  000000 000000        +27 
03:0032DE  000000 000000        +27 
03:0032E0  000000              +27 
03:0032E1  000000              +27 
03:0032E2  000000 000000 000000 000000
                              +27 
03:0032E6  000000 000000 000000 000000
                              +27 
03:0032EA  000000 000000 000000 000000
                              +27 
03:0032EE  003302              +27 
03:0032EF  000000              +27 
03:0032F0  000000 000000        +27 
03:0032F2  000000 000000        +27 
03:0032F4  000000              +27 
03:0032F5  000000              +27 
03:0032F6  000000 000000 000000 000000
                              +27 
03:0032FA  000000 000000 000000 000000
                              +27 
03:0032FE  000000 000000 000000 000000
                              +27 
03:003302  003316              +27 
03:003303  000000              +27 
03:003304  000000 000000        +27 
03:003306  000000 000000        +27 
03:003308  000000              +27 
03:003309  000000              +27 
03:00330A  000000 000000 000000 000000
                              +27 
03:00330E  000000 000000 000000 000000
                              +27 
03:003312  000000 000000 000000 000000
                              +27 
03:003316  00332A              +27 
03:003317  000000              +27 
03:003318  000000 000000        +27 
03:00331A  000000 000000        +27 
03:00331C  000000              +27 
03:00331D  000000              +27 
03:00331E  000000 000000 000000 000000
                              +27 
03:003322  000000 000000 000000 000000
                              +27 
03:003326  000000 000000 000000 000000
                              +27 
03:00332A  00333E              +27 
03:00332B  000000              +27 
03:00332C  000000 000000        +27 
03:00332E  000000 000000        +27 
03:003330  000000              +27 
03:003331  000000              +27 
03:003332  000000 000000 000000 000000
                              +27 
03:003336  000000 000000 000000 000000
                              +27 
03:00333A  000000 000000 000000 000000
                              +27 
03:00333E  003352              +27 
03:00333F  000000              +27 
03:003340  000000 000000        +27 
03:003342  000000 000000        +27 
03:003344  000000              +27 
03:003345  000000              +27 
03:003346  000000 000000 000000 000000
                              +27 
03:00334A  000000 000000 000000 000000
                              +27 
03:00334E  000000 000000 000000 000000
                              +27 
03:003352  003366              +27 
03:003353  000000              +27 
03:003354  000000 000000        +27 
03:003356  000000 000000        +27 
03:003358  000000              +27 
03:003359  000000              +27 
03:00335A  000000 000000 000000 000000
                              +27 
03:00335E  000000 000000 000000 000000
                              +27 
03:003362  000000 000000 000000 000000
                              +27 
03:003366  00337A              +27 
03:003367  000000              +27 
03:003368  000000 000000        +27 
03:00336A  000000 000000        +27 
03:00336C  000000              +27 
03:00336D  000000              +27 
03:00336E  000000 000000 000000 000000
                              +27 
03:003372  000000 000000 000000 000000
                              +27 
03:003376  000000 000000 000000 000000
                              +27 
03:00337A  00338E              +27 
03:00337B  000000              +27 
03:00337C  000000 000000        +27 
03:00337E  000000 000000        +27 
03:003380  000000              +27 
03:003381  000000              +27 
03:003382  000000 000000 000000 000000
                              +27 
03:003386  000000 000000 000000 000000
                              +27 
03:00338A  000000 000000 000000 000000
                              +27 
03:00338E  0033A2              +27 
03:00338F  000000              +27 
03:003390  000000 000000        +27 
03:003392  000000 000000        +27 
03:003394  000000              +27 
03:003395  000000              +27 
03:003396  000000 000000 000000 000000
                              +27 
03:00339A  000000 000000 000000 000000
                              +27 
03:00339E  000000 000000 000000 000000
                              +27 
03:0033A2  0033B6              +27 
03:0033A3  000000              +27 
03:0033A4  000000 000000        +27 
03:0033A6  000000 000000        +27 
03:0033A8  000000              +27 
03:0033A9  000000              +27 
03:0033AA  000000 000000 000000 000000
                              +27 
03:0033AE  000000 000000 000000 000000
                              +27 
03:0033B2  000000 000000 000000 000000
                              +27 
03:0033B6  0033CA              +27 
03:0033B7  000000              +27 
03:0033B8  000000 000000        +27 
03:0033BA  000000 000000        +27 
03:0033BC  000000              +27 
03:0033BD  000000              +27 
03:0033BE  000000 000000 000000 000000
                              +27 
03:0033C2  000000 000000 000000 000000
                              +27 
03:0033C6  000000 000000 000000 000000
                              +27 
03:0033CA  0033DE              +27 
03:0033CB  000000              +27 
03:0033CC  000000 000000        +27 
03:0033CE  000000 000000        +27 
03:0033D0  000000              +27 
03:0033D1  000000              +27 
03:0033D2  000000 000000 000000 000000
                              +27 
03:0033D6  000000 000000 000000 000000
                              +27 
03:0033DA  000000 000000 000000 000000
                              +27 
03:0033DE  0033F2              +27 
03:0033DF  000000              +27 
03:0033E0  000000 000000        +27 
03:0033E2  000000 000000        +27 
03:0033E4  000000              +27 
03:0033E5  000000              +27 
03:0033E6  000000 000000 000000 000000
                              +27 
03:0033EA  000000 000000 000000 000000
                              +27 
03:0033EE  000000 000000 000000 000000
                              +27 
03:0033F2  003406              +27 
03:0033F3  000000              +27 
03:0033F4  000000 000000        +27 
03:0033F6  000000 000000        +27 
03:0033F8  000000              +27 
03:0033F9  000000              +27 
03:0033FA  000000 000000 000000 000000
                              +27 
03:0033FE  000000 000000 000000 000000
                              +27 
03:003402  000000 000000 000000 000000
                              +27 
03:003406  00341A              +27 
03:003407  000000              +27 
03:003408  000000 000000        +27 
03:00340A  000000 000000        +27 
03:00340C  000000              +27 
03:00340D  000000              +27 
03:00340E  000000 000000 000000 000000
                              +27 
03:003412  000000 000000 000000 000000
                              +27 
03:003416  000000 000000 000000 000000
                              +27 
03:00341A  00342E              +27 
03:00341B  000000              +27 
03:00341C  000000 000000        +27 
03:00341E  000000 000000        +27 
03:003420  000000              +27 
03:003421  000000              +27 
03:003422  000000 000000 000000 000000
                              +27 
03:003426  000000 000000 000000 000000
                              +27 
03:00342A  000000 000000 000000 000000
                              +27 
03:00342E  003442              +27 
03:00342F  000000              +27 
03:003430  000000 000000        +27 
03:003432  000000 000000        +27 
03:003434  000000              +27 
03:003435  000000              +27 
03:003436  000000 000000 000000 000000
                              +27 
03:00343A  000000 000000 000000 000000
                              +27 
03:00343E  000000 000000 000000 000000
                              +27 
03:003442  003456              +27 
03:003443  000000              +27 
03:003444  000000 000000        +27 
03:003446  000000 000000        +27 
03:003448  000000              +27 
03:003449  000000              +27 
03:00344A  000000 000000 000000 000000
                              +27 
03:00344E  000000 000000 000000 000000
                              +27 
03:003452  000000 000000 000000 000000
                              +27 
03:003456  00346A              +27 
03:003457  000000              +27 
03:003458  000000 000000        +27 
03:00345A  000000 000000        +27 
03:00345C  000000              +27 
03:00345D  000000              +27 
03:00345E  000000 000000 000000 000000
                              +27 
03:003462  000000 000000 000000 000000
                              +27 
03:003466  000000 000000 000000 000000
                              +27 
03:00346A  00347E              +27 
03:00346B  000000              +27 
03:00346C  000000 000000        +27 
03:00346E  000000 000000        +27 
03:003470  000000              +27 
03:003471  000000              +27 
03:003472  000000 000000 000000 000000
                              +27 
03:003476  000000 000000 000000 000000
                              +27 
03:00347A  000000 000000 000000 000000
                              +27 
03:00347E  003492              +27 
03:00347F  000000              +27 
03:003480  000000 000000        +27 
03:003482  000000 000000        +27 
03:003484  000000              +27 
03:003485  000000              +27 
03:003486  000000 000000 000000 000000
                              +27 
03:00348A  000000 000000 000000 000000
                              +27 
03:00348E  000000 000000 000000 000000
                              +27 
03:003492  0034A6              +27 
03:003493  000000              +27 
03:003494  000000 000000        +27 
03:003496  000000 000000        +27 
03:003498  000000              +27 
03:003499  000000              +27 
03:00349A  000000 000000 000000 000000
                              +27 
03:00349E  000000 000000 000000 000000
                              +27 
03:0034A2  000000 000000 000000 000000
                              +27 
03:0034A6  0034BA              +27 
03:0034A7  000000              +27 
03:0034A8  000000 000000        +27 
03:0034AA  000000 000000        +27 
03:0034AC  000000              +27 
03:0034AD  000000              +27 
03:0034AE  000000 000000 000000 000000
                              +27 
03:0034B2  000000 000000 000000 000000
                              +27 
03:0034B6  000000 000000 000000 000000
                              +27 
03:0034BA  0034CE              +27 
03:0034BB  000000              +27 
03:0034BC  000000 000000        +27 
03:0034BE  000000 000000        +27 
03:0034C0  000000              +27 
03:0034C1  000000              +27 
03:0034C2  000000 000000 000000 000000
                              +27 
03:0034C6  000000 000000 000000 000000
                              +27 
03:0034CA  000000 000000 000000 000000
                              +27 
03:0034CE  0034E2              +27 
03:0034CF  000000              +27 
03:0034D0  000000 000000        +27 
03:0034D2  000000 000000        +27 
03:0034D4  000000              +27 
03:0034D5  000000              +27 
03:0034D6  000000 000000 000000 000000
                              +27 
03:0034DA  000000 000000 000000 000000
                              +27 
03:0034DE  000000 000000 000000 000000
                              +27 
03:0034E2  0034F6              +27 
03:0034E3  000000              +27 
03:0034E4  000000 000000        +27 
03:0034E6  000000 000000        +27 
03:0034E8  000000              +27 
03:0034E9  000000              +27 
03:0034EA  000000 000000 000000 000000
                              +27 
03:0034EE  000000 000000 000000 000000
                              +27 
03:0034F2  000000 000000 000000 000000
                              +27 
03:0034F6  00350A              +27 
03:0034F7  000000              +27 
03:0034F8  000000 000000        +27 
03:0034FA  000000 000000        +27 
03:0034FC  000000              +27 
03:0034FD  000000              +27 
03:0034FE  000000 000000 000000 000000
                              +27 
03:003502  000000 000000 000000 000000
                              +27 
03:003506  000000 000000 000000 000000
                              +27 
03:00350A  00351E              +27 
03:00350B  000000              +27 
03:00350C  000000 000000        +27 
03:00350E  000000 000000        +27 
03:003510  000000              +27 
03:003511  000000              +27 
03:003512  000000 000000 000000 000000
                              +27 
03:003516  000000 000000 000000 000000
                              +27 
03:00351A  000000 000000 000000 000000
                              +27 
03:00351E  003532              +27 
03:00351F  000000              +27 
03:003520  000000 000000        +27 
03:003522  000000 000000        +27 
03:003524  000000              +27 
03:003525  000000              +27 
03:003526  000000 000000 000000 000000
                              +27 
03:00352A  000000 000000 000000 000000
                              +27 
03:00352E  000000 000000 000000 000000
                              +27 
03:003532  003546              +27 
03:003533  000000              +27 
03:003534  000000 000000        +27 
03:003536  000000 000000        +27 
03:003538  000000              +27 
03:003539  000000              +27 
03:00353A  000000 000000 000000 000000
                              +27 
03:00353E  000000 000000 000000 000000
                              +27 
03:003542  000000 000000 000000 000000
                              +27 
03:003546  00355A              +27 
03:003547  000000              +27 
03:003548  000000 000000        +27 
03:00354A  000000 000000        +27 
03:00354C  000000              +27 
03:00354D  000000              +27 
03:00354E  000000 000000 000000 000000
                              +27 
03:003552  000000 000000 000000 000000
                              +27 
03:003556  000000 000000 000000 000000
                              +27 
03:00355A  000000              +27 
03:00355B  000000              +27 
03:00355C  000000 000000        +27 
03:00355E  000000 000000        +27 
03:003560  000000              +27 
03:003561  000000              +27 
03:003562  000000 000000 000000 000000
                              +27 
03:003566  000000 000000 000000 000000
                              +27 
03:00356A  000000 000000 000000 000000
                              +27 
  :                            28 
  :                            29 $(67::,y)
43:000000                     +30 this_app	file_image
43:000001                     +30 
43:000002                     +30 
43:000004                     +30 
43:000006                     +30 
43:000007                     +30 
43:000008                     +30 
43:00000C                     +30 
43:000010                     +30 
  :                            31 
  :                            32 $(0)
  :                            33 
00:000000  60207F              +34 	$base_d	$zenith(3)-03000 2048 2048
00:000001  340003              +34 
00:000002  64C001              +34 
00:000003  340004              +34 
(+04)0f
00:000004  600000              +34 
00:000005  75007A              +34 
00:000006  655000              +34 
00:000007  20000E              +34 
(+04)0f
00:000008  9F0001              +35 	c	(seg$load)	0,,xi	(loader_data:d),,long
00:000009  FD0000              +35 
00:00000A  FCF003              +35 
(+04)0f
00:00000B  FF0003              +35 
00:00000C  38000F              +35 
  :                            36 
  :                            37 
  :                            38 load_request
  :                            39 
  :                            40 	$if	1
00:00000D  55303C              +41 	lx	request1,,xi
(+04)0f
00:00000E  FF0004              +42 	call	(retrieve_callstring)
  :                            43 	$else
  :                            44 	fgets	request1,,xi	180	stdin
  :                            45 	$endif
  :                            46 
00:00000F  303168              +47 	z	suffix
00:000010  303079              +48 	z	request+1	. command search is 2 words and they aren't all
00:000011  FD3078              +49 	sscanf	request1,,xi	$3("%s %:":LF:0),,xi	command1,,xi	request,,xi
00:000012  FD3000              +49 
00:000013  FD356E              +49 
00:000014  FD303C              +49 
00:000015  FCF004              +49 
(+04)0f
00:000016  FF0005              +49 
00:000017  38000F              +49 
  :                            50 .				request,,xi	request2,,xi	request3,,xi	request4,,xi
  :                            51 
00:000018  C5FFFF              +52 	aa	-1,,xi		. command1 doesn't count. It's this application name load
(+00)0f
00:000019  E6008B              +53 	jna	trial_new_prompt
(+00)0f
00:00001A  C6008B              +54 	jza	trial_new_prompt
00:00001B  2031A4              +55 	sa	arguments
  :                            56 
00:00001C  FD303C              +57 	printf	$3("loader: %s":10:0),,xi	request1,,xi
00:00001D  FD3571              +57 
00:00001E  FD0001              +57 
00:00001F  FCF003              +57 
(+04)0f
00:000020  FF0006              +57 
00:000021  38000F              +57 
  :                            58 	
  :                            59 next_request
  :                            60 
00:000022  603078              +61 	la	request			. it's impossible for %s to cause leading space
00:000023  060010              +62 	sar	$word-$byte		. look at leading column of request field
  :                            63 	
00:000024  C5FF01              +64 	aa	-255,,xi		. ^D ?
(+00)0f
00:000025  C600B6              +65 	jza	eof_signalled
00:000026  C500D0              +66 	aa	255-'/',,xi		. a load path?
(+00)0f
00:000027  C60029              +67 	jza	load_by_path
(+00)0f
00:000028  B600C8              +68 	j	command
  :                            69 
  :                            70 load_by_path				. what shall be loaded?
00:000029  303168              +71 	z	suffix
00:00002A  FD3168              +72 	sscanf	request,,xi	$3("%:*%s"),,xi	request2,,xi	suffix,,xi
00:00002B  FD30B4              +72 
00:00002C  FD3575              +72 
00:00002D  FD3078              +72 
00:00002E  FCF004              +72 
(+04)0f
00:00002F  FF0005              +72 
00:000030  38000F              +72 
00:000031  FD30B4              +73 	c	(fspath)	request2,,xi
00:000032  FCF001              +73 
(+04)0f
00:000033  FF0007              +73 
00:000034  38000F              +73 
(+00)0f
00:000035  C600A2              +74 	jza	trialu
  :                            75 
00:000036  5831AC              +76 	ly	app_cache_free
00:000037  700003              +77 	tnz	y
(+00)0f
00:000038  B6003A              +77 
(+00)0f
00:000039  B60085              +78 	j	no_slot
  :                            79 
00:00003A  40B000              +80 	lr	this_app:next
00:00003B  0031AC              +81 	sr	app_cache_free
00:00003C  1831AB              +82 	sy	app_of_reference
00:00003D  4031AD              +83 	lr	apps_loaded
00:00003E  00B000              +84 	sr	this_app:next
00:00003F  1831AD              +85 	sy	apps_loaded
  :                            86 
00:000040  C7B002              +87 	ds	this_app:fs_offset
00:000041  30B001              +88 	z	this_app:user_count
  :                            89 
00:000042  8F0008              +90 	qpush	8
00:000043  8F0008              +91 	qpush	8
00:000044  87B010              +92 	qpop	this_app:leaf_name
00:000045  8731A6              +93 	qpop	loadname
  :                            94 
00:000046  FCB004              +95 	c	(iframe_load)	a,,long	this_app:transfer_gate,,i
00:000047  9F0004              +95 
00:000048  FCF003              +95 
(+04)0f
00:000049  FF0008              +95 
00:00004A  38000F              +95 
(+00)0f
00:00004B  E600A9              +96 	jna	trialy
  :                            97 
00:00004C  8F0004              +98 	printf	$3("[%lx:%lx]":10:0),,xi	a,,float
00:00004D  FD3577              +98 
00:00004E  FD0001              +98 
00:00004F  FCF006              +98 
(+04)0f
00:000050  FF0006              +98 
00:000051  38000F              +98 
  :                            99 
  :                            100 find_and?
00:000052  703168              +101 	tz	suffix			. is there a ? token after *
(+00)0f
00:000053  B60076              +102 	j	load_and?		. yes, it's not just load-execute
  :                            103 					. no, it's load-execute
00:000054  5831AB              +104 	ly	app_of_reference
00:000055  4FB00C              +105 	ql	this_app:launch_profile
  :                            106 
(+04)0f
00:000056  600009              +107 	la	(0800000s)
00:000057  94B004              +108 	or	this_app:transfer_gate,,i
  :                            109 
00:000058  750042              +110 	ii	SPAWN$
(+00)0f
00:000059  C600C2              +111 	jza	nonstarter
00:00005A  2031A5              +112 	sa	new_process
00:00005B  5831AB              +113 	ly	app_of_reference
00:00005C  6CB010              +114 	lb	this_app:leaf_name,,i
00:00005D  750049              +115 	ii	TAG$
  :                            116 
  :                            117 update_go
00:00005E  340020              +118 	sabr	32			. look in new process TCB
00:00005F  5D3078              +119 	ly	request,,xi
(+04)0f
00:000060  FF000A              +120 	call	(forward_callstring)	. enable app to read its call line
(+04)0d
00:000061  60800B              +121 	la	*(32*/12++ABT-01000+2)	. read his vector list pointer
00:000062  340020              +122 	sabr	32
  :                            123 
00:000063  CF2188              +124 	dl	handle(1)		. please use my stdin stdout stderr
(+04)0d
00:000064  C7800C              +125 	ds	*(32*/12++handle(1)-02000)
  :                            126 
00:000065  4F218A              +127 	ql	handle(2)
(+04)0d
00:000066  47800D              +128 	qs	*(32*/12++handle(2)-02000)
  :                            129 
(+04)0f
00:000067  60000E              +130 	la	(0C00001s)
00:000068  750060              +131 	ii	XBASE$32
  :                            132 
00:000069  FD31A6              +133 	printf	$3("%x %s":10:0),,xi	new_process	loadname,,xi
00:00006A  F831A5              +133 
00:00006B  FD357B              +133 
00:00006C  FD0001              +133 
00:00006D  FCF004              +133 
(+04)0f
00:00006E  FF0006              +133 
00:00006F  38000F              +133 
00:000070  750041              +134 	ii	YIELD$
  :                            135 
00:000071  6031A5              +136 trialx	la	new_process
00:000072  750072              +137 trialx1	ii	THREAD$STATE
(+00)0f
00:000073  B6008B              +138 	j	trial_end_detect	. concluded or stopped
  :                            139 
00:000074  750041              +140 	ii	YIELD$			. if this were encapsulated
(+00)0f
00:000075  B60071              +141 	j	trialx			. its name would be waitpid()
  :                            142 
  :                            143 load_and?
00:000076  4F3168              +144 	ql	suffix
(+04)0f
00:000077  48000F              +145 	lk	(-1*/$word-$byte)
(+04)0f
00:000078  AF0010              +146 	mtane	('+'*/$word-$byte)	. load and don't execute?
(+00)0f
00:000079  B6007B              +146 
(+00)0f
00:00007A  B6008B              +147 	j	trial_new_prompt	. it's done, ask me again
  :                            148 					. it's an application in the loaded file
00:00007B  4731A6              +149 	qs	loadname
  :                            150 
00:00007C  FD3168              +151 	lc	qapps	app_of_reference suffix,,xi	. group*application
00:00007D  F831AB              +151 
00:00007E  FCF002              +151 
(+00)0f
00:00007F  3E010F              +151 
00:000080  38000F              +151 
  :                            152 
(+00)0f
00:000081  C600C2              +153 	jza	nonstarter
(+00)0f
00:000082  E600BC              +154 	jna	start_error
00:000083  2031A5              +155 	sa	new_process
(+00)0f
00:000084  B6005E              +156 	j	update_go
  :                            157 
00:000085  FD357E              +158 no_slot	printf	$3("maximum dynamic apps loaded\n":10:0),,xi
00:000086  FD0001              +158 
00:000087  FCF002              +158 
(+04)0f
00:000088  FF0006              +158 
00:000089  38000F              +158 
(+00)0f
00:00008A  B6008B              +159 	j	trial_new_prompt
  :                            160 
  :                            161 trial_end_detect
  :                            162 trial_new_prompt
  :                            163 
00:00008B  FD3589              +164 	printf	$3("load>":0),,xi
00:00008C  FD0001              +164 
00:00008D  FCF002              +164 
(+04)0f
00:00008E  FF0006              +164 
00:00008F  38000F              +164 
00:000090  FD0001              +165 	fflush	stdout
00:000091  FCF001              +165 
(+04)0f
00:000092  FF0011              +165 
00:000093  38000F              +165 
  :                            166 
  :                            167 	$if	1
00:000094  303079              +168 	z	request+1
00:000095  FD00B4              +169 	fgets	request,,xi	180	stdin
00:000096  FD3078              +169 
00:000097  FD0000              +169 
00:000098  FCF003              +169 
(+04)0f
00:000099  FF0012              +169 
00:00009A  38000F              +169 
00:00009B  160018              +169 
00:00009C  1D0018              +169 
(+00)0f
00:00009D  EE00A0              +169 
(+00)0f
00:00009E  CE00A0              +169 
00:00009F  653078              +169 
(+00)0f
00:0000A0  C600B6              +170 	jza	eof_signalled
(+00)0f
00:0000A1  B60022              +171 	j	next_request
  :                            172 	$else
  :                            173 
  :                            174 	fgets	request1,,i	174	stdin
  :                            175 	la	request1
  :                            176 	jza	data_void
  :                            177 	z	request+1	. command search is 2 words and they aren't all
  :                            178 	z	request2
  :                            179 	z	request
  :                            180 	z	suffix
  :                            181 	sscanf	request1,,xi	$3("%s %s %s %s":0),,xi	request,,xi	request2,,xi	request3,,xi	request4,,xi
  :                            182 	jza	trial_new_prompt
  :                            183 	sa	arguments
  :                            184 	j	next_request
  :                            185 	$endif
  :                            186 
00:0000A2  FD3078              +187 trialu	printf	$3("%s not located":10:0),,xi	request,,xi
00:0000A3  FD358B              +187 
00:0000A4  FD0001              +187 
00:0000A5  FCF003              +187 
(+04)0f
00:0000A6  FF0006              +187 
00:0000A7  38000F              +187 
(+00)0f
00:0000A8  B6008B              +188 	j	trial_new_prompt
  :                            189  
00:0000A9  F80004              +190 trialy	printf	$3("load error %d":10:0),,xi a
00:0000AA  FD3591              +190 
00:0000AB  FD0001              +190 
00:0000AC  FCF003              +190 
(+04)0f
00:0000AD  FF0006              +190 
00:0000AE  38000F              +190 
(+00)0f
00:0000AF  B6008B              +191 	j	trial_new_prompt
  :                            192 
  :                            193 data_void
00:0000B0  FD3596              +194 	printf	$3("data void":10:0),,xi
00:0000B1  FD0001              +194 
00:0000B2  FCF002              +194 
(+04)0f
00:0000B3  FF0006              +194 
00:0000B4  38000F              +194 
(+00)0f
00:0000B5  B60108              +195 	j	trialz
  :                            196 
  :                            197 eof_signalled
00:0000B6  FD359A              +198 	printf	$3("eof signalled":10:0),,xi
00:0000B7  FD0001              +198 
00:0000B8  FCF002              +198 
(+04)0f
00:0000B9  FF0006              +198 
00:0000BA  38000F              +198 
(+00)0f
00:0000BB  B60108              +199 	j	trialz
  :                            200 
  :                            201 start_error
00:0000BC  F80004              +202 	printf	$3("%d":10:0),,xi a
00:0000BD  FD359F              +202 
00:0000BE  FD0001              +202 
00:0000BF  FCF003              +202 
(+04)0f
00:0000C0  FF0006              +202 
00:0000C1  38000F              +202 
  :                            203 
00:0000C2  FD35A1              +204 nonstarter printf $3("process unassigned":10:0),,xi
00:0000C3  FD0001              +204 
00:0000C4  FCF002              +204 
(+04)0f
00:0000C5  FF0006              +204 
00:0000C6  38000F              +204 
(+00)0f
00:0000C7  B6008B              +205 	j	trial_new_prompt
  :                            206 
00:0000C8  3030F1              +207 command	z	request3+1
00:0000C9  3030B5              +208 	z	request2+1
  :                            209 
00:0000CA  FD30B4              +210 	sscanf	request,,xi	$3("%s %s":0),,xi	request3,,xi	request2,,xi
00:0000CB  FD30F0              +210 
00:0000CC  FD35A8              +210 
00:0000CD  FD3078              +210 
00:0000CE  FCF004              +210 
(+04)0f
00:0000CF  FF0005              +210 
00:0000D0  38000F              +210 
  :                            211 
  :                            212 .	la	arguments
(+00)0f
00:0000D1  E6008B              +213 	jna	trial_new_prompt
(+00)0f
00:0000D2  C6008B              +214 	jza	trial_new_prompt
  :                            215 
  :                            216 .	next the search for builtin commands
  :                            217 
00:0000D3  550006              +218 	lookup	request3	@?, @eof, @run, ifsync, ifswap, @@stay
00:0000D4  85FFFF              +218 
(+04)0c
00:0000D5  60A01F              +218 
00:0000D6  CFC000              +218 
00:0000D7  DF30F0              +218 
00:0000D8  900005              +218 
(+04)0c
00:0000D9  68A025              +218 
00:0000DA  C6D000              +218 
00:0000DB  700002              +218 
(+00)0f
00:0000DC  B600D4              +218 
  :                            219 
  :                            220 .	next the search for dynamic loaded programs
  :                            221 
(+00)0f
00:0000DD  3E0143              +222 	lcal	find_in_loaded_list
(+00)0f
00:0000DE  B600ED              +223 	j	notso
  :                            224 
00:0000DF  1831AB              +225 	sy	app_of_reference
  :                            226 
00:0000E0  603168              +227 	la	suffix
(+04)0f
00:0000E1  48000F              +228 	lk	(-1*/$word-$byte)
(+04)0f
00:0000E2  AF002B              +229 	mta	('-'*/$word-$byte)
(+00)0f
00:0000E3  B60052              +230 	j	find_and?		. execute app or contained app
  :                            231 					. unless suffix is delete *-
00:0000E4  60B005              +232 	la	this_app:transfer_gate+1
(+04)0f
00:0000E5  A0002C              +233 	and	(07FFFFF)		. brush off the flag
00:0000E6  750045              +234 	ii	BANK$FREE		. return storage to kernel
  :                            235 
00:0000E7  60B000              +236 	la	this_app:next
00:0000E8  208000              +237 	sa	*r			. previous pointer
00:0000E9  6031AC              +238 	la	app_cache_free
00:0000EA  20B000              +239 	sa	this_app:next
00:0000EB  1831AC              +240 	sy	app_cache_free
  :                            241 
(+00)0f
00:0000EC  B6008B              +242 	j	trial_new_prompt
  :                            243 
00:0000ED  FD3078              +244 notso	printf	$3("%s not loaded":10:0),,xi	request,,xi
00:0000EE  FD35AA              +244 
00:0000EF  FD0001              +244 
00:0000F0  FCF003              +244 
(+04)0f
00:0000F1  FF0006              +244 
00:0000F2  38000F              +244 
(+00)0f
00:0000F3  B6008B              +245 	j	trial_new_prompt
  :                            246 
(+00)0f
00:0000F4  3E0132              +247 @?	lcal	list
(+00)0f
00:0000F5  B6008B              +248 	j	trial_new_prompt
(+04)0f
00:0000F6  4F002D              +249 @run	ql	(runstart, 7, request2, THREAD_FP(2)q)
00:0000F7  750047              +250 	ii	THREAD$
(+00)0f
00:0000F8  B6008B              +251 	j	trial_new_prompt
  :                            252 
00:0000F9  550005              +253 ifsync	lx	5,,xi
00:0000FA  750059              +254 	ii	KERNEL$B1_1
(+04)0f
00:0000FB  FF0031              +255 	call	(__ift2_align)
00:0000FC  750058              +256 	ii	B1$
(+00)0f
00:0000FD  B6008B              +257 	j	trial_new_prompt
  :                            258 
00:0000FE  550005              +259 ifswap	lx	5,,xi
00:0000FF  750059              +260 	ii	KERNEL$B1_1
(+04)0f
00:000100  FF0032              +261 	call	(__ift2_mirror)
00:000101  750058              +262 	ii	B1$
(+00)0f
00:000102  B6008B              +263 	j	trial_new_prompt
  :                            264 
00:000103  FD0000              +265 @@stay	c	(__fd_zero_timeout)	stdin
00:000104  FCF001              +265 
(+04)0f
00:000105  FF0033              +265 
00:000106  38000F              +265 
(+00)0f
00:000107  B6008B              +266 	j	trial_new_prompt
  :                            267 
  :                            268 @eof
00:000108  750041              +269 trialz	ii	YIELD$			. let the print proceed before EXIT$
00:000109  3D0000              +270 	fret	0
  :                            271 
  :                            272 .	asynchronous thread to run a script in background
  :                            273 
00:00010A  F80004              +274 runstart	c	(run_start)	a
00:00010B  FCF001              +274 
(+04)0f
00:00010C  FF0034              +274 
00:00010D  38000F              +274 
00:00010E  350000              +275 	lret	0			. thread exit
  :                            276 
  :                            277 .	execute an app within a file of multiple apps
  :                            278 
                                qapps	$head_near	 params(appxp,		int	;
                                				app_namep,	int )	;
                                							;
                                			scalars(startpx,	int	;
00:00010F  FD0000              +283 				app_name_words,	int	)
00:000110  FD0000              +283 
  :                            284 
00:000111  F8F005              +285 	c	(strlenx)	app_namep
00:000112  FCF001              +285 
(+04)0f
00:000113  FF0035              +285 
00:000114  38000F              +285 
00:000115  28F000              +286 	sb	app_name_words
  :                            287 
00:000116  58F004              +288 	ly	appxp
00:000117  4FB008              +289 	ql	this_app:lookup_mount
00:000118  4DFFFF              +290 	lk	-1,,xi
(+04)0f
00:000119  AF0036              +291         mta     (MOUNT$,,3)
(+00)0f
00:00011A  B6012E              +292         j       qappz		. no mount pointer, zero the result
  :                            293 
00:00011B  60B005              +294 	la	this_app:transfer_gate+1
(+04)0f
00:00011C  A0002C              +295 	and	(07FFFFF)	. start page index
00:00011D  20F001              +296 	sa	startpx
  :                            297 				. get directory block from directory descriptor
00:00011E  CF0006              +298 	dl	6		. -> descriptor word offset application_templates
00:00011F  36000C              +299         dsl     12		. separate relative page / offset
00:000120  9D0020              +300         orB     32,,xi		. tag to general I/O window
00:000121  C0F001              +301         aa      startpx		. add start page index to relative index
00:000122  340020              +302         sabr    32		. open the window
00:000123  4E000C              +303         rbr     12		. normalise the pointer
00:000124  CFD002              +304         dl      2, b            . granule identifier directory block
00:000125  360006              +305         dsl     6               . -> word offset in device
  :                            306 
                                        c       (qstart)        startpx					;
                                                                a,,long					;
                                                                app_name_words				;
00:000126  F8F005              +310                                 app_namep
00:000127  F8F001              +310 
00:000128  9F0004              +310 
00:000129  F8F005              +310 
00:00012A  FCF005              +310 
(+04)0f
00:00012B  FF0037              +310 
00:00012C  38000F              +310 
  :                            311 
(+00)0f
00:00012D  D6012F              +312         jnza	qappx
  :                            313 
00:00012E  650000              +314 qappz	la	0,,xi
00:00012F  FCF002              +315 qappx	$ret
00:000130  38000F              +315 
00:000131  350000              +315 
  :                            316 
00:000132  5831AD              +317 list	ly	apps_loaded
(+00)0f
00:000133  B60140              +318 	j	list?
  :                            319 
00:000134  F80003              +320 list!	push	y
00:000135  4FB010              +321 	ql	this_app:leaf_name
00:000136  4731A6              +322 	qs	loadname	. place the name before a 5th word of zero
  :                            323 
                                	printf	$3("%lx:%lx %s":10:0),,xi	this_app:transfer_gate,,float	;
00:000137  FD31A6              +325 						loadname,,xi
00:000138  8FB004              +325 
00:000139  FD35AF              +325 
00:00013A  FD0001              +325 
00:00013B  FCF007              +325 
(+04)0f
00:00013C  FF0006              +325 
00:00013D  38000F              +325 
00:00013E  380003              +326 	pop	y
00:00013F  58B000              +327 	ly	0, y
00:000140  700003              +328 list?	tz	y
(+00)0f
00:000141  B60134              +329 	j	list!
00:000142  350000              +330 	lret	0
  :                            331 
  :                            332 
  :                            333 find_in_loaded_list
00:000143  300009              +334 	z	9
00:000144  30000A              +335 	z	10
00:000145  30000B              +336 	z	11		. 4-word loaded file search argument
00:000146  303168              +337 	z	suffix		. by default no *suffix
  :                            338 
00:000147  FD3168              +339 	sscanf	request,,xi    $3("%:*%s"),,xi    8,,xi    suffix,,xi
00:000148  FD0008              +339 
00:000149  FD3575              +339 
00:00014A  FD3078              +339 
00:00014B  FCF004              +339 
(+04)0f
00:00014C  FF0005              +339 
00:00014D  38000F              +339 
  :                            340 
00:00014E  5D31AD              +341 	ly	apps_loaded,,xi
  :                            342 
  :                            343 find_it_then
00:00014F  400003              +344 	lr	y		. we need a previous if suffix *- delete
00:000150  58B000              +345 	ly	0, y
00:000151  700003              +346 	tnz	y
(+00)0f
00:000152  B60154              +346 
00:000153  350000              +347 	lret	0		. no
00:000154  4FB010              +348 	ql	this_app:leaf_name
00:000155  DF0008              +349 	dan	8
(+00)0f
00:000156  D6014F              +350 	jnza	find_it_then
(+00)0f
00:000157  DE014F              +351 	jnzb	find_it_then
00:000158  CF0006              +352 	dl	6
00:000159  DF000A              +353 	dan	10
(+00)0f
00:00015A  D6014F              +354 	jnza	find_it_then
(+00)0f
00:00015B  DE014F              +355 	jnzb	find_it_then
00:00015C  4F0008              +356 	ql	8
00:00015D  4731A6              +357 	qs	loadname
00:00015E  350001              +358 	lret	1		. yes
  :                            25 
*EOF*
03:00356e+257320253A0A000000
03:003571+6C6F616465723A2025730A00
03:003575+253A2A257300
03:003577+5B256C783A256C785D0A0000
03:00357b+25782025730A000000
03:00357e+6D6178696D756D2064796E616D69632061707073206C6F61
6465645C6E0A000000
03:003589+6C6F61643E00
03:00358b+2573206E6F74206C6F63617465640A000000
03:003591+6C6F6164206572726F722025640A00
03:003596+6461746120766F69640A0000
03:00359a+656F66207369676E616C6C65640A00
03:00359f+25640A000000
03:0035a1+70726F6365737320756E61737369676E65640A0000
03:0035a8+257320257300
03:0035aa+2573206E6F74206C6F616465640A00
03:0035af+256C783A256C782025730A00
04:000000+[0000]18:000000
04:000001+[0001]30:000000000000
04:000003+0001CD
04:000004+00022B
04:000005+0001D8
04:000006+0001DB
04:000007+0001C5
04:000008+0001D0
04:000009+800000
04:00000a+000229
04:00000b+020042
04:00000c+020188
04:00000d+02018A
04:00000e+C00001
04:00000f+FF0000
04:000010+2B0000
04:000011+0001D6
04:000012+0001E4
04:000013+403F00000000
04:000015+40656F660000
04:000017+4072756E0000
04:000019+696673796E63
04:00001b+696673776170
04:00001d+404073746179
04:00001f+(04)18:000013
(04)18:000015
(04)18:000017
(04)18:000019
(04)18:00001B
(04)18:00001D
04:000025+(00)18:0000F4
(00)18:000108
(00)18:0000F6
(00)18:0000F9
(00)18:0000FE
(00)18:000103
04:00002b+2D0000
04:00002c+7FFFFF
04:00002d+(00)18*/48:00010A0000070030B4004800
04:000031+000113
04:000032+000114
04:000033+0001F2
04:000034+00014A
04:000035+00019A
04:000036+[0002]08*/10:000003
04:000037+0001D1
:$(00):000000:00015F :$(01):001000:001000 :$(02):002000:003000 :$(03):003000:0035B3 :$(04):000000:000038 :$(43):000000:000014 
loader.msm: object code 10702 bytes: 0 errors: 3 undefined labels
